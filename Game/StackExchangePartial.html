<style>
    .centered {
       left: 20%;
        top: 10%;
        width: 50%;
    }
    img{
        width: 32%;
    }
</style>

<div class="centered" style="background-color: floralwhite">
<h4 style="text-align: center" >What is This Project? <a target="_blank" href="/Game/proposal.pdf" class="fa fa-file"></a></h4>
<div class="card " >
    <div class="card-body" >
        <div style="text-align: center">
        Have you ever used Stack Exchange? Well if you have then you know that the community can be less than inviting. As a matter of fact, your questions can be downvoted so much that you could be in danger of losing your account. To combat this, I suggest a search engine used for searching the thousands of unanswered questions on Stack Exchange, but specifically catered toward your skills. Whether it be specifically programming, or more niche like mythology; you will be able to find questions that you are knowledgeable about so that you can help others and get those highly desired upvotes. This will ensure that those people like you and I can not only help others, but continue to ask questions in a community as unforgiving as Stack Exchange.
        </div>
        <hr>
        <h4><a href="https://github.com/03jordan11/WebFarm/tree/feature/DataMining">GitHub</a></h4>
        <h4>Similar Apps</h4>
        <hr>
        <ul class="list-group">
            <li class="list-group-item"><a href="https://stackoverflow.com/search?q=" target="_blank">Stack Overflow</a></li>
            <li class="list-group-item"><a href="https://atomiks.github.io/reddit-user-analyser/">Reddit User Analyzer</a></li>
            <li class="list-group-item"><a href="https://www.tineye.com/"> Tiny Eye</a></li>
        </ul>
        <hr>
        <h4>Search</h4>
        <hr>
        <div>
            <label>Search</label>
            <input class="form-control textQuery">
            <button class="btn btn-primary btn-circle searchTextBtn"><i class="fa fa-search"></i></button>
            <ul class="list-group searchResults">
                <li class="list-group-item">Question 1</li>
                <li class="list-group-item">Question 2</li>
                <li class="list-group-item">Question 3</li>
                <li class="list-group-item">Question 4</li>
            </ul>
        </div>
        <hr>
        <h4>Photo Search</h4>
        <div>
            <label>search</label>
            <input class="form-control">
            <img src="https://images.unsplash.com/photo-1565040474823-0367e6415df0?ixlib=rb-1.2.1&ixid=eyJhcHBfaWQiOjExMDk0fQ&auto=format&fit=crop&w=698&q=80" data-toggle="tooltip" data-placement="bottom" title="this img">
            <img src="https://images.unsplash.com/photo-1568752172055-6961c4146efd?ixlib=rb-1.2.1&ixid=eyJhcHBfaWQiOjEyMDd9&auto=format&fit=crop&w=700&q=80" data-toggle="tooltip" data-placement="bottom" title="this img">
            <img src="https://images.unsplash.com/photo-1523703591032-c582f1eedf32?ixlib=rb-1.2.1&ixid=eyJhcHBfaWQiOjEyMDd9&auto=format&fit=crop&w=634&q=80" data-toggle="tooltip" data-placement="bottom" title="this img">
        </div>
    </div>

</div>
</div>

<script>
    let stopWords = ["i", "me", "my", "myself", "we", "our", "ours", "ourselves", "you", "your", "yours", "yourself", "yourselves", "he", "him", "his", "himself", "she", "her", "hers", "herself", "it", "its", "itself", "they", "them", "their", "theirs", "themselves", "what", "which", "who", "whom", "this", "that", "these", "those", "am", "is", "are", "was", "were", "be", "been", "being", "have", "has", "had", "having", "do", "does", "did", "doing", "a", "an", "the", "and", "but", "if", "or", "because", "as", "until", "while", "of", "at", "by", "for", "with", "about", "against", "between", "into", "through", "during", "before", "after", "above", "below", "to", "from", "up", "down", "in", "out", "on", "off", "over", "under", "again", "further", "then", "once", "here", "there", "when", "where", "why", "how", "all", "any", "both", "each", "few", "more", "most", "other", "some", "such", "no", "nor", "not", "only", "own", "same", "so", "than", "too", "very", "s", "t", "can", "will", "just", "don", "should", "now"];
    let things = [];
    let idfRank = [];
    for(i = 1; i < 3; i++){
    $.ajax({
        url: `https://api.stackexchange.com/questions/no-answers?page=${i}&site=stackoverflow&pagesize=100&key=eiqXEE0OHaNxJJj1yS238w((&filter=withbody`,
        type: "GET",
        success: function(data){
            data.items.forEach(function(value, index){
                things.push(value);
            });
            console.log(things);

        }
    })

    }

    $(".searchTextBtn").on('click', function(){
        var query = $(".textQuery").val();
        query = removeStopwords(query);
        if(query == "") return false;
        var testSplit = query.split(" ");
        let results = createInvertedIndex(testSplit, things);
        console.log(results);
        let ranking = sumRank(results);
        console.log(ranking);
        let top5 = getTop5(results, ranking);
        console.log(top5);
        addToPage(top5);
    });


    ////////////FUNCTIONS//////////
    //removes stopwords from query
    function removeStopwords(str) {
        res = []
        words = str.split(' ')
        for(i=0;i<words.length;i++) {
            if(!stopWords.includes(words[i])) {
                res.push(words[i])
            }
        }
        return(res.join(' '))
    }

    //Add results to the page
    function addToPage(data){
        let htmlToAdd = "";
        idfRank.forEach(function(value1, index1){
            htmlToAdd = htmlToAdd + `<li class="list-group-item"><h2>${index1 + 1} - ${value1}</h2></li>`;
        })
        htmlToAdd = htmlToAdd + "<hr>";
        data.forEach(function(value, index){
            let name = value.question.title;
            let link = value.question.link;
            let score = value.score;
            let listItem = `<li class="list-group-item"><a href="${link}">${name}</a><h2>${score}</h2></li>`
            htmlToAdd = htmlToAdd + listItem;
        })
        $(".searchResults").html(htmlToAdd);
    }

    //Returns top results
    function getTF(data){
        return data.frequency !== 0 ? data.frequency/data.question.body.length : 0;
    }

    function getIDF(data){
        let totalDocCount = 0;
        let docCount = 0;
        data.forEach(function(value, index){
            if(value.frequency > 0)
                docCount++;
            totalDocCount++;
        });
        return docCount !== 0 ? Math.log(totalDocCount/docCount) : 0;
    }

    function insertRank(data){
        idfRank = [];
        data.forEach(function (value, index){
            let idf = getIDF(value);
            value.forEach(function(innerValue, innerIndex){
               innerValue.rank = getTF(innerValue) * idf;
            });
            idfRank.push(idf);
        });
        return data;
    }



    //pass documents as the objects
    function createInvertedIndex(query, documents){
        let invertedIndex = [];
        query.forEach(function(value, index){
            let tempArray = [];
            documents.forEach(function(valueDoc, indexDoc){
                let newObject = {
                    "frequency": wordsInDoc(valueDoc.body, value),
                    "question": valueDoc,
                    "rank": 0
                }
                tempArray.push(newObject);
            });
            invertedIndex[index] = tempArray;
        });

        return insertRank(invertedIndex);
    }

    //Returns number of words found in a document
    function wordsInDoc(documentText, word){
        documentText += "";
        word += "";
        if (word.length <= 0) return (documentText.length + 1);

        let n = 0,
            pos = 0,
            step = word.length;

        while (true) {
            pos = documentText.indexOf(word, pos);
            if (pos >= 0) {
                ++n;
                pos += step;
            } else break;
        }
        return n;
    }

    //TESTING THIS FOR ADDING BOTH OF THE RANNKED SCORED IF THERE IS MORE THAN ONE WORD
    function sumRank(data){
        let totalScore = [];
        let len = data[0].length;
        for(i = 0; i < len; i++){
            let score = 0;
            data.forEach(function(value, index){
                score = score + value[i].rank
            });
            let newObject = {
                "index":i,
                "score": score
            }
            totalScore.push(newObject);
        }
        return totalScore
    }

    //Returns a list of the top 5 documents based on their rank
    function getTop5(invertedIndex, rankList){
        let documents = [];
        let returnDocuments = [];
        invertedIndex[0].forEach(function(value, index){
           documents.push(value.question);
        });
        let sortedRankList = rankList.sort(function(a,b){return b.score - a.score});
        let counter = 0;

        for(i = 0; i < sortedRankList.length; i++){
            if(counter === 5) break;
            var temp = {
                "score": sortedRankList[i].score,
                "question": documents[sortedRankList[i].index]
            }
            returnDocuments.push(temp);
            counter++;
        }
        return returnDocuments;
    }
    ///////////////END FUNCTIONS////////////////////
</script>